# 智能合约漏洞检测中的检索增强生成集成大型语言模型

发布时间：2024年07月20日

`RAG` `网络安全`

> Retrieval Augmented Generation Integrated Large Language Models in Smart Contract Vulnerability Detection

# 摘要

> 随着去中心化金融（DeFi）的迅猛发展，智能合约漏洞引发的财务损失日益严重，凸显了高效安全审计的迫切需求。攻击频率的上升，使得审计服务的需求与日俱增，尤其对资金有限的独立开发者和中小企业构成负担。本研究通过结合检索增强生成（RAG）与大型语言模型（LLM），特别是利用GPT-4-1106的128k令牌上下文窗口，构建了一个包含830个已知漏洞合约的向量存储，采用Pinecone、OpenAI的text-embedding-ada-002及LangChain技术，设计了漏洞检测的二进制提示。实验首先对52个智能合约进行40次测试，验证了RAG-LLM在引导检测中的62.7%成功率；随后在无提示漏洞类型的“盲”审计中，219个合约的测试显示了60.71%的成功率。尽管成果喜人，我们仍强调当前人工审计的必要性，并以此研究展示了一种经济高效的智能合约审计方法，旨在推动安全审计的民主化。

> The rapid growth of Decentralized Finance (DeFi) has been accompanied by substantial financial losses due to smart contract vulnerabilities, underscoring the critical need for effective security auditing. With attacks becoming more frequent, the necessity and demand for auditing services has escalated. This especially creates a financial burden for independent developers and small businesses, who often have limited available funding for these services. Our study builds upon existing frameworks by integrating Retrieval-Augmented Generation (RAG) with large language models (LLMs), specifically employing GPT-4-1106 for its 128k token context window. We construct a vector store of 830 known vulnerable contracts, leveraging Pinecone for vector storage, OpenAI's text-embedding-ada-002 for embeddings, and LangChain to construct the RAG-LLM pipeline. Prompts were designed to provide a binary answer for vulnerability detection. We first test 52 smart contracts 40 times each against a provided vulnerability type, verifying the replicability and consistency of the RAG-LLM. Encouraging results were observed, with a 62.7% success rate in guided detection of vulnerabilities. Second, we challenge the model under a "blind" audit setup, without the vulnerability type provided in the prompt, wherein 219 contracts undergo 40 tests each. This setup evaluates the general vulnerability detection capabilities without hinted context assistance. Under these conditions, a 60.71% success rate was observed. While the results are promising, we still emphasize the need for human auditing at this time. We provide this study as a proof of concept for a cost-effective smart contract auditing process, moving towards democratic access to security.

![智能合约漏洞检测中的检索增强生成集成大型语言模型](../../../paper_images/2407.14838/figure1.png)

[Arxiv](https://arxiv.org/abs/2407.14838)